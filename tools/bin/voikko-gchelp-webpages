#!/usr/bin/python
# -*- coding: utf-8 -*-

# Copyright 2012 Harri Pitk√§nen (hatapitk@iki.fi)
# Script for automating the build of grammar checker help web pages.
# This script should be run in the directory where the resulting
# help pages are written.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

import codecs
import sys
from os import access, F_OK
from os import waitpid
from shutil import copyfile, move
from datetime import datetime
import voikkoutils
from xml.dom.minidom import parse

def printHelpContent(helpFile, errorCode, errorTitle, errorContent):
	helpFile.write(u"<html><head><title>Voikko &mdash; kielioppivirheen selitys</title>")
	helpFile.write(u"<body><h1>%s</h1>" % errorTitle)
	helpFile.write(u"<p>")
	helpFile.write(errorContent)
	helpFile.write(u"</p></body></html>")

# === Main program ===

xmlData = parse(voikkoutils.get_preference("svnroot") + "/trunk/libvoikko/data/gchelp.xml")

for errorElement in xmlData.documentElement.getElementsByTagName("error"):
	errorCode = errorElement.getAttribute("code")
	errorTitle = errorElement.getElementsByTagName("description")[0].firstChild.wholeText;
	errorContent = errorElement.getElementsByTagName("help")[0].firstChild.wholeText;
	helpFile = codecs.open(errorCode + ".html", "w", "UTF-8")
	printHelpContent(helpFile, errorCode, errorTitle, errorContent)
	helpFile.close()
