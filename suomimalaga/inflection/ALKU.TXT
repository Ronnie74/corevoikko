# Suomi-malaga, suomen kielen muoto-opin kuvaus.
#
# Tekijänoikeus © 2006-2007 Hannu Väisänen (Etunimi.Sukunimi@joensuu.fi)
#
# Tämä ohjelma on vapaa; tätä ohjelmaa on sallittu levittää
# edelleen ja muuttaa GNU yleisen lisenssin (GPL lisenssin)
# ehtojen mukaan sellaisina kuin Free Software Foundation
# on ne julkaissut; joko Lisenssin version 2, tai (valinnan
# mukaan) minkä tahansa myöhemmän version mukaisesti.
#
# Tätä ohjelmaa levitetään siinä toivossa, että se olisi
# hyödyllinen, mutta ilman mitään takuuta; ilman edes
# hiljaista takuuta kaupallisesti hyväksyttävästä laadusta tai
# soveltuvuudesta tiettyyn tarkoitukseen. Katso GPL
# lisenssistä lisää yksityiskohtia.
#
# Tämän ohjelman mukana pitäisi tulla kopio GPL
# lisenssistä; jos näin ei ole, kirjoita osoitteeseen Free
# Software Foundation Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.
#
# Tämän ohjeman linkittäminen staattisesti tai dynaamisesti
# muihin moduuleihin on ohjelmaan perustuvan teoksen
# tekemistä, joka on siis GPL lisenssin ehtojen alainen.
#
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; see the file COPYING.  If not, write to the
# Free Software Foundation, Inc., 59 Temple Place -  Suite 330, Boston, MA
# 02111-1307 USA.
#
# Linking this program statically or dynamically with other modules is
# making a combined work based on this program.  Thus, the terms and
# conditions of the GNU General Public License cover the whole
# combination.


# Tämä tiedosto on tehty ohjelmalla generoi.sh --- älä muuta!


include "suomi.inc";


# Vain ne aksenttimerkit, jotka ovat ISO-8859-15:ssä, paitsi š ja ž.
# Merkit ovat ISO-8859-15:n mukaisessa järjestyksessä.
#
define @aksenttimerkki := "ŸÀÁÂÃÇÈÉÊËÌÍÎÏÐÑÒÓÔÙÚÛÝàáâãçèéêëìíîïðñòóôùúûýÿ";
define @korvausmerkki  := "YAAAACEEEEIIIIDNOOOUUUYaaaaceeeeiiiidnooouuuyy";


allo_rule generate_allos ($tietue1):
  define $malli := switch (malli);  # Katso tiedosto suomi-*.pro.


##define $aa := transmit (<"a"> + <$tietue1.perusmuoto> + <$tietue1.alku> + <$tietue1.äs>);
#define $ö := transmit ("[perusmuoto: §" + $tietue1.perusmuoto + "§" +
#                       ", alku: §"      + $tietue1.alku + "§" +
#                       ", luokka: "     + value_string ($tietue1.luokka) +
#                       ", jatko: "      + value_string ($tietue1.jatko) +
#                       ", äs: "         + value_string ($tietue1.äs) +
#                       "];");

#define $a := transmit ($tietue1);
#if ($tietue1.perusmuoto /= nil) then
#  define $b := transmit ("Tavutus2 " + $tietue1.perusmuoto + " " + tavutus($tietue1.perusmuoto));
#end;

  if ($malli = sukija) then
    if ($tietue1.jatko_sukija /= nil) then
      $tietue1 :=+ [jatko: $tietue1.jatko_sukija];
    end;
    if ($tietue1.alku_sukija /= nil) then
      $tietue1 :=+ [alku: $tietue1.alku_sukija];
    end;
  end;

  if ($malli = voikko) then
    if ($tietue1.jatko_voikko /= nil) then
      $tietue1 :=+ [jatko: $tietue1.jatko_voikko];
    end;
    if ($tietue1.alku_voikko /= nil) then
      $tietue1 :=+ [alku: $tietue1.alku_voikko];
    end;
  end;


  assert (value_type($tietue1) = record);

  define $tietuelista := <$tietue1>;


  if ($malli = sukija) then
    define $tavujen_lkm := tavujen_määrä ($tietue1.perusmuoto);

    #
    # Useimmat kolmitavuiset (i)nen-loppuiset sanat hyväksytään i:llisinä ja i:ttöminä.
    # Esim. kelta(i)nen, hevo(i)nen.
    #
#    if ((nainen in $tietue1.jatko) and
#        ($tietue1.luokka in <nimisana, laatusana, nimi_laatusana>) and
#        ($tietue1.perusmuoto matches ".*" + @kerake + "[aouyäö]i?nen") and
#        (not ($tietue1.perusmuoto matches ".*m[aä]inen")) and # Ei "omainen".
#        ($tavujen_lkm = 3) and
#        ($tietue1.lähtösana = nil) then
#      define $tietue2 := $tietue1;
#      if (substring($tietue1.alku,1R) = "i") then
#        $tietue2.alku := substring($tietue1.alku,1,2R);   # Keltainen => keltanen.
#      else
#        $tietue2.alku :=+ "i";                            # Hevonen   => hevoinen.
#      end;
#      $tietue2 :=+ [lähtösana: $tietue1.perusmuoto, lähtöalku: $tietue1.alku];
#      $tietue2.perusmuoto := $tietue2.alku + "nen";
#      $tietuelista := <$tietue1, $tietue2>;
#    end;

   # Korvataan aksentilliset merkit aksentittomilla (esim. Linné => Linne).
   #
   if (($tietue1.perusmuoto /= nil) and
       ($tietue1.perusmuoto matches ".*[" + @aksenttimerkki + "]+.*")) then
     define $tietue2 := $tietue1;
     $tietue2 :=+ [lähtösana: $tietue1.perusmuoto];
     $tietue2.alku       := tr ($tietue2.alku,       @aksenttimerkki, @korvausmerkki);
     $tietue2.perusmuoto := tr ($tietue2.perusmuoto, @aksenttimerkki, @korvausmerkki);
#define $a := transmit ($tietue1);
#define $b := transmit ($tietue2);
     $tietuelista := <$tietue1, $tietue2>;
   end;


   # Korjataan alku-kenttien arvoja. Nämä pitäisi tehdä, kun
   # generoidaan XML-tiedostosta Malaga-koodia.
   #
   if ((rakentaa in $tietue1.jatko) and
       ($tietue1.alku matches ".*[aeiouyäö]" : $alku, "n" : $loppu)) then
     $tietue1.alku := $alku;
     $tietuelista := <$tietue1>;
   end;
   if ((harteet in $tietue1.jatko) and ($tietue1.perusmuoto = "harteet")) then
     $tietue1.alku := "hart";
     $tietuelista := <$tietue1>;
   end;
   if (((airut in $tietue1.jatko) and ($tietue1.perusmuoto = "neitsyt")) or
       ((risti in $tietue1.jatko) and ($tietue1.perusmuoto = "ori"))) then
     stop;
   end;

   # Sanat, jotka generoidaan automaattisesti Sukija-versiossa.
   #
   if (($tietue1.perusmuoto /= nil) and
       ($tietue1.perusmuoto in <"otto", "voima">) and
       ($tietue1.luokka in <nimisana>)) then
     stop;
   end;
   if ($tietue1.perusmuoto in <"itkettynyt", "itkettyä", "jälkeenjäänyt", "ylösnoussut">) then
     stop;
   end;

   # Nämä tunnistetaan etuliite + sana -yhdistelminä.
   #
   if (($tietue1.perusmuoto /= nil) and
       (($tietue1.perusmuoto matches "herras(kartano|mies|poika|väki)") or
        ($tietue1.perusmuoto matches "sisään(ajo|meno|tulo)"))) then
     stop;
   end;

   # Nämä sanat voivat olla myös erillisinä sanoina.
   #
   if (($tietue1.tiedot /= nil) and (ysj in $tietue1.tiedot) and
       (($tietue1.perusmuoto /= nil) and
       (($tietue1.perusmuoto = "vuotias") and ($tietue1.luokka = nimi_laatusana)))) then
     $tietue1.tiedot :=- <ysj>;
     $tietuelista := <$tietue1>;
   end;
 end;


  choose $tietue in $tietuelista;

#define $a := transmit ($tietue);

  if (($malli = voikko) and ($tietue.tiedot /= nil) and
      ((latex in $tietue.tiedot) or
       (murre in $tietue.tiedot) or
       (ei_voikko in $tietue.tiedot))) then
    stop;

  elseif (($malli = sukija) and ($tietue.tiedot /= nil) and
          (ei_sukija in $tietue.tiedot)) then
    stop;

#####################################################################
##=================================================================##
#####################################################################

